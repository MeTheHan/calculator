<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NovaCalc Pro | Modern Hesap Makinesi</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #6c63ff;
            --primary-dark: #554fd8;
            --secondary: #ff6584;
            --dark: #2a2a3c;
            --darker: #1e1e2c;
            --light: #f5f5f7;
            --gray: #8a8aa0;
            --success: #4ade80;
            --warning: #f59e0b;
            --error: #ef4444;
            --radius: 16px;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        .light-theme {
            --primary: #6c63ff;
            --primary-dark: #554fd8;
            --secondary: #ff6584;
            --dark: #f5f5f7;
            --darker: #e0e0e5;
            --light: #2a2a3c;
            --gray: #5a5a6e;
            --success: #16a34a;
            --warning: #d97706;
            --error: #dc2626;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, var(--darker), var(--dark));
            color: var(--light);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            overflow-x: hidden;
            transition: var(--transition);
        }

        .container {
            width: 100%;
            max-width: 450px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            animation: fadeIn 1s ease-out;
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .logo i {
            font-size: 2.5rem;
            color: var(--primary);
        }

        h1 {
            font-size: 2.2rem;
            font-weight: 700;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 5px;
        }

        .tagline {
            color: var(--gray);
            font-size: 1rem;
            font-weight: 300;
        }

        .calculator {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(255, 255, 255, 0.1);
            animation: slideUp 0.8s ease-out;
            transition: var(--transition);
        }

        .light-theme .calculator {
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .display {
            background: rgba(0, 0, 0, 0.3);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 20px;
            text-align: right;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            overflow: hidden;
            transition: var(--transition);
        }

        .light-theme .display {
            background: rgba(0, 0, 0, 0.05);
        }

        .previous-operation {
            font-size: 1rem;
            color: var(--gray);
            min-height: 24px;
            word-break: break-all;
        }

        .current-operation {
            font-size: 2.2rem;
            font-weight: 600;
            word-break: break-all;
        }

        .buttons-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
        }

        .btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: var(--radius);
            color: var(--light);
            font-size: 1.3rem;
            font-weight: 500;
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            user-select: none;
        }

        .light-theme .btn {
            background: rgba(0, 0, 0, 0.05);
            color: var(--light);
        }

        .btn:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-3px);
        }

        .light-theme .btn:hover {
            background: rgba(0, 0, 0, 0.1);
        }

        .btn:active {
            transform: translateY(1px);
        }

        .btn-operation {
            background: rgba(108, 99, 255, 0.2);
            color: var(--primary);
        }

        .btn-operation:hover {
            background: rgba(108, 99, 255, 0.3);
        }

        .btn-equals {
            background: var(--primary);
            color: white;
            grid-column: span 2;
        }

        .btn-equals:hover {
            background: var(--primary-dark);
        }

        .btn-clear, .btn-delete {
            background: rgba(239, 68, 68, 0.2);
            color: var(--error);
        }

        .btn-clear:hover, .btn-delete:hover {
            background: rgba(239, 68, 68, 0.3);
        }

        .btn-scientific {
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning);
        }

        .btn-scientific:hover {
            background: rgba(245, 158, 11, 0.3);
        }

        .history-panel {
            margin-top: 25px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(255, 255, 255, 0.1);
            max-height: 200px;
            overflow-y: auto;
            animation: fadeIn 1s ease-out 0.5s both;
            transition: var(--transition);
        }

        .light-theme .history-panel {
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .history-title {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .clear-history {
            background: none;
            border: none;
            color: var(--gray);
            cursor: pointer;
            font-size: 0.9rem;
            transition: var(--transition);
        }

        .clear-history:hover {
            color: var(--error);
        }

        .history-item {
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            font-size: 0.9rem;
            display: flex;
            justify-content: space-between;
            cursor: pointer;
            transition: var(--transition);
        }

        .light-theme .history-item {
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .history-item:hover {
            background: rgba(255, 255, 255, 0.05);
            padding-left: 10px;
            padding-right: 10px;
            margin-left: -10px;
            margin-right: -10px;
            border-radius: 8px;
        }

        .light-theme .history-item:hover {
            background: rgba(0, 0, 0, 0.05);
        }

        .history-expression {
            color: var(--gray);
        }

        .history-result {
            color: var(--primary);
            font-weight: 600;
        }

        footer {
            margin-top: 30px;
            text-align: center;
            color: var(--gray);
            font-size: 0.9rem;
            animation: fadeIn 1s ease-out 1s both;
        }

        .features {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .feature {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.8rem;
            background: rgba(255, 255, 255, 0.05);
            padding: 5px 10px;
            border-radius: 20px;
            transition: var(--transition);
        }

        .light-theme .feature {
            background: rgba(0, 0, 0, 0.05);
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { 
                opacity: 0;
                transform: translateY(30px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Scientific mode */
        .scientific-buttons {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-top: 15px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease;
        }

        .scientific-buttons.active {
            max-height: 500px;
        }

        .btn-sci {
            background: rgba(255, 255, 255, 0.05);
            font-size: 1rem;
            height: 50px;
        }

        .light-theme .btn-sci {
            background: rgba(0, 0, 0, 0.05);
        }

        /* Responsive */
        @media (max-width: 480px) {
            .container {
                max-width: 100%;
            }
            
            .calculator {
                padding: 20px;
            }
            
            .btn {
                height: 60px;
                font-size: 1.1rem;
            }
            
            .current-operation {
                font-size: 1.8rem;
            }
            
            .scientific-buttons {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        /* Theme toggle */
        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--light);
            cursor: pointer;
            transition: var(--transition);
        }

        .light-theme .theme-toggle {
            background: rgba(0, 0, 0, 0.1);
            color: var(--light);
        }

        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: rotate(30deg);
        }

        .light-theme .theme-toggle:hover {
            background: rgba(0, 0, 0, 0.15);
        }

        /* Toast notification */
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--primary);
            color: white;
            padding: 12px 24px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            transition: transform 0.3s ease;
            z-index: 1000;
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
        }

        /* Memory functions */
        .memory-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            justify-content: center;
        }

        .btn-memory {
            background: rgba(74, 222, 128, 0.2);
            color: var(--success);
            font-size: 0.9rem;
            height: 40px;
            flex: 1;
        }

        .btn-memory:hover {
            background: rgba(74, 222, 128, 0.3);
        }

        /* Settings panel */
        .settings-panel {
            margin-top: 20px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: var(--radius);
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: var(--transition);
        }

        .light-theme .settings-panel {
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .settings-option {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--gray);
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        /* Expression display */
        .expression-display {
            font-size: 0.9rem;
            color: var(--gray);
            margin-bottom: 5px;
            min-height: 20px;
        }

        /* Sound toggle */
        .sound-toggle {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--light);
            cursor: pointer;
            transition: var(--transition);
        }

        .light-theme .sound-toggle {
            background: rgba(0, 0, 0, 0.1);
            color: var(--light);
        }

        .sound-toggle:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .light-theme .sound-toggle:hover {
            background: rgba(0, 0, 0, 0.15);
        }

        /* Vibration effect */
        @keyframes vibrate {
            0% { transform: translate(0); }
            20% { transform: translate(-2px, 2px); }
            40% { transform: translate(-2px, -2px); }
            60% { transform: translate(2px, 2px); }
            80% { transform: translate(2px, -2px); }
            100% { transform: translate(0); }
        }

        .vibrate {
            animation: vibrate 0.3s linear;
        }
    </style>
</head>
<body>
    <button class="sound-toggle" id="soundToggle">
        <i class="fas fa-volume-up"></i>
    </button>

    <button class="theme-toggle" id="themeToggle">
        <i class="fas fa-moon"></i>
    </button>

    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-calculator"></i>
            </div>
            <h1>NovaCalc Pro</h1>
            <p class="tagline">Matematiksel işlemlerde yeni bir deneyim</p>
        </header>
        
        <main class="calculator">
            <div class="memory-buttons">
                <button class="btn btn-memory" data-memory="mc">MC</button>
                <button class="btn btn-memory" data-memory="mr">MR</button>
                <button class="btn btn-memory" data-memory="m+">M+</button>
                <button class="btn btn-memory" data-memory="m-">M-</button>
                <button class="btn btn-memory" data-memory="ms">MS</button>
            </div>
            
            <div class="display">
                <div class="expression-display" id="expressionDisplay"></div>
                <div class="previous-operation" id="previousOperation"></div>
                <div class="current-operation" id="currentOperation">0</div>
            </div>
            
            <div class="buttons-grid">
                <button class="btn btn-clear" data-action="clear">C</button>
                <button class="btn btn-delete" data-action="delete">⌫</button>
                <button class="btn btn-scientific" data-action="scientific">SCI</button>
                <button class="btn btn-operation" data-operation="÷">÷</button>
                
                <button class="btn" data-number="7">7</button>
                <button class="btn" data-number="8">8</button>
                <button class="btn" data-number="9">9</button>
                <button class="btn btn-operation" data-operation="×">×</button>
                
                <button class="btn" data-number="4">4</button>
                <button class="btn" data-number="5">5</button>
                <button class="btn" data-number="6">6</button>
                <button class="btn btn-operation" data-operation="-">-</button>
                
                <button class="btn" data-number="1">1</button>
                <button class="btn" data-number="2">2</button>
                <button class="btn" data-number="3">3</button>
                <button class="btn btn-operation" data-operation="+">+</button>
                
                <button class="btn" data-number="0">0</button>
                <button class="btn" data-number=".">.</button>
                <button class="btn btn-equals" data-action="calculate">=</button>
            </div>
            
            <div class="scientific-buttons" id="scientificButtons">
                <button class="btn btn-sci" data-scientific="sin">sin</button>
                <button class="btn btn-sci" data-scientific="cos">cos</button>
                <button class="btn btn-sci" data-scientific="tan">tan</button>
                <button class="btn btn-sci" data-scientific="log">log</button>
                <button class="btn btn-sci" data-scientific="ln">ln</button>
                
                <button class="btn btn-sci" data-scientific="π">π</button>
                <button class="btn btn-sci" data-scientific="e">e</button>
                <button class="btn btn-sci" data-scientific="^">x^y</button>
                <button class="btn btn-sci" data-scientific="√">√</button>
                <button class="btn btn-sci" data-scientific="!">x!</button>
                
                <button class="btn btn-sci" data-scientific="(">(</button>
                <button class="btn btn-sci" data-scientific=")">)</button>
                <button class="btn btn-sci" data-scientific="%">%</button>
                <button class="btn btn-sci" data-scientific="1/x">1/x</button>
                <button class="btn btn-sci" data-scientific="abs">|x|</button>
            </div>
        </main>

        <div class="settings-panel">
            <div class="settings-option">
                <span>Virgülden sonra:</span>
                <select id="decimalPrecision">
                    <option value="8">8 basamak</option>
                    <option value="4">4 basamak</option>
                    <option value="2">2 basamak</option>
                    <option value="0">Tam sayı</option>
                </select>
            </div>
            <div class="settings-option">
                <span>Animasyonlar:</span>
                <label class="switch">
                    <input type="checkbox" id="animationsToggle" checked>
                    <span class="slider"></span>
                </label>
            </div>
        </div>
        
        <div class="history-panel">
            <div class="history-header">
                <div class="history-title">Hesaplama Geçmişi</div>
                <button class="clear-history" id="clearHistory">Temizle</button>
            </div>
            <div class="history-list" id="historyList">
                <!-- History items will be added here dynamically -->
            </div>
        </div>
        
        <footer>
            <p>© 2023 NovaCalc Pro - Tüm matematiksel işlemler için modern çözüm</p>
            <div class="features">
                <div class="feature"><i class="fas fa-bolt"></i> Hızlı Hesaplama</div>
                <div class="feature"><i class="fas fa-mobile-alt"></i> Mobil Uyumlu</div>
                <div class="feature"><i class="fas fa-history"></i> İşlem Geçmişi</div>
                <div class="feature"><i class="fas fa-flask"></i> Bilimsel Fonksiyonlar</div>
                <div class="feature"><i class="fas fa-palette"></i> Temalar</div>
            </div>
        </footer>
    </div>

    <div class="toast" id="toast"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Calculator state
            const calculator = {
                displayValue: '0',
                previousValue: '',
                operation: null,
                waitingForNewValue: false,
                memory: 0,
                history: JSON.parse(localStorage.getItem('calculatorHistory')) || [],
                soundEnabled: true,
                decimalPrecision: 8,
                animationsEnabled: true
            };

            // DOM Elements
            const currentOperationElement = document.getElementById('currentOperation');
            const previousOperationElement = document.getElementById('previousOperation');
            const expressionDisplayElement = document.getElementById('expressionDisplay');
            const historyList = document.getElementById('historyList');
            const scientificButtons = document.getElementById('scientificButtons');
            const clearHistoryBtn = document.getElementById('clearHistory');
            const themeToggle = document.getElementById('themeToggle');
            const soundToggle = document.getElementById('soundToggle');
            const decimalPrecisionSelect = document.getElementById('decimalPrecision');
            const animationsToggle = document.getElementById('animationsToggle');
            const toast = document.getElementById('toast');
            
            // Initialize from localStorage
            const savedTheme = localStorage.getItem('calculatorTheme');
            const savedSound = localStorage.getItem('calculatorSound');
            const savedPrecision = localStorage.getItem('calculatorPrecision');
            const savedAnimations = localStorage.getItem('calculatorAnimations');
            
            if (savedTheme === 'light') {
                document.body.classList.add('light-theme');
                themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
            }
            
            if (savedSound === 'false') {
                calculator.soundEnabled = false;
                soundToggle.innerHTML = '<i class="fas fa-volume-mute"></i>';
            }
            
            if (savedPrecision) {
                calculator.decimalPrecision = parseInt(savedPrecision);
                decimalPrecisionSelect.value = savedPrecision;
            }
            
            if (savedAnimations === 'false') {
                calculator.animationsEnabled = false;
                animationsToggle.checked = false;
            }
            
            // Update display
            function updateDisplay() {
                currentOperationElement.textContent = calculator.displayValue;
                previousOperationElement.textContent = calculator.previousValue + (calculator.operation ? ' ' + calculator.operation : '');
                
                // Update expression display
                if (calculator.previousValue && calculator.operation) {
                    expressionDisplayElement.textContent = `${calculator.previousValue} ${calculator.operation}`;
                } else {
                    expressionDisplayElement.textContent = '';
                }
            }
            
            // Play sound
            function playSound() {
                if (!calculator.soundEnabled) return;
                
                // Create a simple beep sound using Web Audio API
                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.value = 800;
                    oscillator.type = 'sine';
                    
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.1);
                } catch (e) {
                    console.log("Web Audio API not supported");
                }
            }
            
            // Show toast notification
            function showToast(message) {
                toast.textContent = message;
                toast.classList.add('show');
                setTimeout(() => {
                    toast.classList.remove('show');
                }, 3000);
            }
            
            // Format number based on precision
            function formatNumber(num) {
                if (calculator.decimalPrecision === 0) {
                    return Math.round(num).toString();
                }
                
                return Number(num).toFixed(calculator.decimalPrecision);
            }
            
            // Add to history
            function addToHistory(expression, result) {
                const historyItem = { 
                    expression, 
                    result, 
                    timestamp: new Date().toLocaleString('tr-TR') 
                };
                calculator.history.unshift(historyItem);
                
                // Keep only last 10 items
                if (calculator.history.length > 10) {
                    calculator.history.pop();
                }
                
                // Save to localStorage
                localStorage.setItem('calculatorHistory', JSON.stringify(calculator.history));
                
                // Update history display
                updateHistoryDisplay();
            }
            
            // Update history display
            function updateHistoryDisplay() {
                historyList.innerHTML = '';
                
                if (calculator.history.length === 0) {
                    historyList.innerHTML = '<div style="text-align: center; color: var(--gray); padding: 20px;">Henüz işlem yapılmadı</div>';
                    return;
                }
                
                calculator.history.forEach((item, index) => {
                    const historyItemElement = document.createElement('div');
                    historyItemElement.className = 'history-item';
                    historyItemElement.innerHTML = `
                        <div class="history-expression">${item.expression}</div>
                        <div class="history-result">${item.result}</div>
                    `;
                    historyItemElement.addEventListener('click', () => {
                        calculator.displayValue = item.result;
                        updateDisplay();
                        showToast('Sonuç ekrana aktarıldı');
                    });
                    historyList.appendChild(historyItemElement);
                });
            }
            
            // Input digit
            function inputDigit(digit) {
                playSound();
                
                if (calculator.waitingForNewValue) {
                    calculator.displayValue = digit;
                    calculator.waitingForNewValue = false;
                } else {
                    calculator.displayValue = calculator.displayValue === '0' ? digit : calculator.displayValue + digit;
                }
            }
            
            // Input decimal
            function inputDecimal() {
                playSound();
                
                if (calculator.waitingForNewValue) {
                    calculator.displayValue = '0.';
                    calculator.waitingForNewValue = false;
                    return;
                }
                
                if (!calculator.displayValue.includes('.')) {
                    calculator.displayValue += '.';
                }
            }
            
            // Handle operator
            function handleOperator(nextOperator) {
                playSound();
                const inputValue = parseFloat(calculator.displayValue);
                
                if (calculator.operation && !calculator.waitingForNewValue) {
                    const result = performCalculation();
                    calculator.displayValue = formatNumber(result);
                    addToHistory(`${calculator.previousValue} ${calculator.operation} ${inputValue}`, result);
                }
                
                calculator.previousValue = calculator.displayValue;
                calculator.waitingForNewValue = true;
                calculator.operation = nextOperator;
            }
            
            // Perform calculation
            function performCalculation() {
                const prevValue = parseFloat(calculator.previousValue);
                const currentValue = parseFloat(calculator.displayValue);
                
                if (isNaN(prevValue) || isNaN(currentValue)) return '';
                
                let computation;
                switch (calculator.operation) {
                    case '+':
                        computation = prevValue + currentValue;
                        break;
                    case '-':
                        computation = prevValue - currentValue;
                        break;
                    case '×':
                        computation = prevValue * currentValue;
                        break;
                    case '÷':
                        if (currentValue === 0) {
                            showToast('Sıfıra bölme hatası!');
                            return 'Hata';
                        }
                        computation = prevValue / currentValue;
                        break;
                    case '^':
                        computation = Math.pow(prevValue, currentValue);
                        break;
                    default:
                        return '';
                }
                
                // Round to avoid floating point issues
                computation = Math.round(computation * 100000000) / 100000000;
                return computation;
            }
            
            // Reset calculator
            function resetCalculator() {
                calculator.displayValue = '0';
                calculator.previousValue = '';
                calculator.operation = null;
                calculator.waitingForNewValue = false;
            }
            
            // Delete last character
            function deleteLast() {
                playSound();
                
                if (calculator.displayValue.length > 1) {
                    calculator.displayValue = calculator.displayValue.slice(0, -1);
                } else {
                    calculator.displayValue = '0';
                }
            }
            
            // Handle scientific functions
            function handleScientificFunction(func) {
                playSound();
                const currentValue = parseFloat(calculator.displayValue);
                let result;
                
                switch (func) {
                    case 'sin':
                        result = Math.sin(currentValue * Math.PI / 180); // Convert to radians
                        break;
                    case 'cos':
                        result = Math.cos(currentValue * Math.PI / 180);
                        break;
                    case 'tan':
                        result = Math.tan(currentValue * Math.PI / 180);
                        break;
                    case 'log':
                        if (currentValue <= 0) {
                            showToast('Logaritma için pozitif sayı gerekli!');
                            return;
                        }
                        result = Math.log10(currentValue);
                        break;
                    case 'ln':
                        if (currentValue <= 0) {
                            showToast('Doğal logaritma için pozitif sayı gerekli!');
                            return;
                        }
                        result = Math.log(currentValue);
                        break;
                    case 'π':
                        result = Math.PI;
                        break;
                    case 'e':
                        result = Math.E;
                        break;
                    case '√':
                        if (currentValue < 0) {
                            showToast('Negatif sayının karekökü alınamaz!');
                            return;
                        }
                        result = Math.sqrt(currentValue);
                        break;
                    case '!':
                        if (currentValue < 0 || !Number.isInteger(currentValue)) {
                            showToast('Faktoriyel için pozitif tam sayı gerekli!');
                            return;
                        }
                        result = factorial(currentValue);
                        break;
                    case '1/x':
                        if (currentValue === 0) {
                            showToast('Sıfırın tersi alınamaz!');
                            return;
                        }
                        result = 1 / currentValue;
                        break;
                    case 'abs':
                        result = Math.abs(currentValue);
                        break;
                    case '%':
                        result = currentValue / 100;
                        break;
                    case '(':
                    case ')':
                        // Parentheses handling would require a more complex expression parser
                        showToast('Parantez özelliği geliştirme aşamasında');
                        return;
                    default:
                        return;
                }
                
                // Round to avoid floating point issues
                if (result !== undefined) {
                    result = Math.round(result * 100000000) / 100000000;
                    calculator.displayValue = formatNumber(result);
                    addToHistory(`${func}(${currentValue})`, result);
                }
            }
            
            // Calculate factorial
            function factorial(n) {
                if (n < 0) return NaN;
                if (n === 0 || n === 1) return 1;
                
                let result = 1;
                for (let i = 2; i <= n; i++) {
                    result *= i;
                }
                return result;
            }
            
            // Handle memory functions
            function handleMemoryFunction(memAction) {
                playSound();
                const currentValue = parseFloat(calculator.displayValue);
                
                switch (memAction) {
                    case 'mc':
                        calculator.memory = 0;
                        showToast('Hafıza temizlendi');
                        break;
                    case 'mr':
                        calculator.displayValue = formatNumber(calculator.memory);
                        updateDisplay();
                        showToast('Hafızadan alındı');
                        break;
                    case 'm+':
                        calculator.memory += currentValue;
                        showToast('Hafızaya eklendi');
                        break;
                    case 'm-':
                        calculator.memory -= currentValue;
                        showToast('Hafızadan çıkarıldı');
                        break;
                    case 'ms':
                        calculator.memory = currentValue;
                        showToast('Hafızaya kaydedildi');
                        break;
                }
            }
            
            // Toggle theme
            function toggleTheme() {
                document.body.classList.toggle('light-theme');
                const isLight = document.body.classList.contains('light-theme');
                
                if (isLight) {
                    themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
                    localStorage.setItem('calculatorTheme', 'light');
                    showToast('Açık tema etkin');
                } else {
                    themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
                    localStorage.setItem('calculatorTheme', 'dark');
                    showToast('Koyu tema etkin');
                }
            }
            
            // Toggle sound
            function toggleSound() {
                calculator.soundEnabled = !calculator.soundEnabled;
                
                if (calculator.soundEnabled) {
                    soundToggle.innerHTML = '<i class="fas fa-volume-up"></i>';
                    localStorage.setItem('calculatorSound', 'true');
                    showToast('Ses etkin');
                } else {
                    soundToggle.innerHTML = '<i class="fas fa-volume-mute"></i>';
                    localStorage.setItem('calculatorSound', 'false');
                    showToast('Ses devre dışı');
                }
            }
            
            // Update decimal precision
            function updateDecimalPrecision() {
                calculator.decimalPrecision = parseInt(decimalPrecisionSelect.value);
                localStorage.setItem('calculatorPrecision', calculator.decimalPrecision);
                
                // Reformat current display value
                if (calculator.displayValue !== '0' && calculator.displayValue !== 'Hata') {
                    calculator.displayValue = formatNumber(parseFloat(calculator.displayValue));
                    updateDisplay();
                }
                
                showToast(`Ondalık hassasiyet: ${calculator.decimalPrecision} basamak`);
            }
            
            // Toggle animations
            function toggleAnimations() {
                calculator.animationsEnabled = animationsToggle.checked;
                localStorage.setItem('calculatorAnimations', calculator.animationsEnabled);
                
                if (calculator.animationsEnabled) {
                    showToast('Animasyonlar etkin');
                } else {
                    showToast('Animasyonlar devre dışı');
                }
            }
            
            // Add vibration effect to button
            function addVibrationEffect(button) {
                if (!calculator.animationsEnabled) return;
                
                button.classList.add('vibrate');
                setTimeout(() => {
                    button.classList.remove('vibrate');
                }, 300);
            }
            
            // Event Listeners
            document.querySelector('.buttons-grid').addEventListener('click', event => {
                const { target } = event;
                
                if (!target.matches('button')) return;
                
                addVibrationEffect(target);
                
                if (target.dataset.number) {
                    inputDigit(target.dataset.number);
                    updateDisplay();
                    return;
                }
                
                if (target.dataset.operation) {
                    handleOperator(target.dataset.operation);
                    updateDisplay();
                    return;
                }
                
                if (target.dataset.action) {
                    if (target.dataset.action === 'calculate') {
                        const result = performCalculation();
                        calculator.displayValue = formatNumber(result);
                        calculator.previousValue = '';
                        calculator.operation = null;
                        calculator.waitingForNewValue = true;
                        updateDisplay();
                        return;
                    }
                    
                    if (target.dataset.action === 'clear') {
                        resetCalculator();
                        updateDisplay();
                        return;
                    }
                    
                    if (target.dataset.action === 'delete') {
                        deleteLast();
                        updateDisplay();
                        return;
                    }
                    
                    if (target.dataset.action === 'scientific') {
                        scientificButtons.classList.toggle('active');
                        return;
                    }
                }
            });
            
            // Scientific buttons
            scientificButtons.addEventListener('click', event => {
                const { target } = event;
                
                if (!target.matches('button')) return;
                
                addVibrationEffect(target);
                
                if (target.dataset.scientific) {
                    handleScientificFunction(target.dataset.scientific);
                    updateDisplay();
                }
            });
            
            // Memory buttons
            document.querySelector('.memory-buttons').addEventListener('click', event => {
                const { target } = event;
                
                if (!target.matches('button')) return;
                
                addVibrationEffect(target);
                
                if (target.dataset.memory) {
                    handleMemoryFunction(target.dataset.memory);
                }
            });
            
            // Clear history
            clearHistoryBtn.addEventListener('click', () => {
                calculator.history = [];
                localStorage.setItem('calculatorHistory', JSON.stringify(calculator.history));
                updateHistoryDisplay();
                showToast('Geçmiş temizlendi');
            });
            
            // Theme toggle
            themeToggle.addEventListener('click', toggleTheme);
            
            // Sound toggle
            soundToggle.addEventListener('click', toggleSound);
            
            // Decimal precision
            decimalPrecisionSelect.addEventListener('change', updateDecimalPrecision);
            
            // Animations toggle
            animationsToggle.addEventListener('change', toggleAnimations);
            
            // Keyboard support
            document.addEventListener('keydown', event => {
                const { key } = event;
                
                if ((key >= '0' && key <= '9') || key === '.') {
                    event.preventDefault();
                    if (key === '.') {
                        inputDecimal();
                    } else {
                        inputDigit(key);
                    }
                    updateDisplay();
                }
                
                if (key === '+' || key === '-' || key === '*' || key === '/') {
                    event.preventDefault();
                    const operationMap = {
                        '+': '+',
                        '-': '-',
                        '*': '×',
                        '/': '÷'
                    };
                    handleOperator(operationMap[key]);
                    updateDisplay();
                }
                
                if (key === 'Enter' || key === '=') {
                    event.preventDefault();
                    const result = performCalculation();
                    calculator.displayValue = formatNumber(result);
                    calculator.previousValue = '';
                    calculator.operation = null;
                    calculator.waitingForNewValue = true;
                    updateDisplay();
                }
                
                if (key === 'Escape' || key === 'Delete') {
                    event.preventDefault();
                    resetCalculator();
                    updateDisplay();
                }
                
                if (key === 'Backspace') {
                    event.preventDefault();
                    deleteLast();
                    updateDisplay();
                }
            });
            
            // Initialize
            updateDisplay();
            updateHistoryDisplay();
        });
    </script>
</body>
</html>
